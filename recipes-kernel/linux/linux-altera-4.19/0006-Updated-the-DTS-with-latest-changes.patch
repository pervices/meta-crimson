From bf49ea0ed4dea319c59366e3c900306eb8d20acc Mon Sep 17 00:00:00 2001
From: Amir Ghanbari Bavarsad <amir.b@pervices.com>
Date: Thu, 21 Mar 2019 13:58:57 +0000
Subject: [PATCH 6/9] Updated the DTS with latest changes

---
 .../dts/altera/socfpga_stratix10_socdk.dts    | 87 ++++++++++++++-----
 1 file changed, 67 insertions(+), 20 deletions(-)

diff --git a/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts b/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
index a3848b24ecfc..2ba503cae4e1 100644
--- a/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
+++ b/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
@@ -22,9 +22,7 @@
 
 	aliases {
 		serial0 = &uart1;
-		ethernet0 = &gmac0;
-		ethernet1 = &gmac1;
-		ethernet2 = &gmac2;
+		ethernet0 = &gmac1;
 	};
 
 	chosen {
@@ -47,7 +45,7 @@
 	soc {
 		clocks {
 			osc1 {
-				clock-frequency = <25000000>;
+				clock-frequency = <125000000>;
 			};
 		};
 	};
@@ -62,12 +60,15 @@
 };
 
 &gmac0 {
-	status = "okay";
+	status = "disabled";
 	phy-mode = "rgmii";
 	phy-handle = <&phy0>;
+
 	interrupt-parent = <&portb>;
 	// pin 19 (index starting at 0) of portb (IOB_20)
-	interrupts = <19 IRQ_TYPE_LEVEL_HIGH>;
+	interrupts = <19 IRQ_TYPE_LEVEL_LOW>;
+	altr,sysmgr-syscon = <&sysmgr 0x00000044 0>;
+
 	max-frame-size = <9000>;
 
 	mdio0 {
@@ -77,20 +78,66 @@
 		phy0: ethernet-phy@0 {
 			reg = <4>;
 
-			// TODO:
-			// Need to calculate these values
+			/*
+			 * All skews are offset since hardware skew values for the ksz9031
+			 * range from a negative skew to a positive skew.
+			 * See the micrel-ksz90x1.txt Documentation file for details.
+			 */
 			txd0-skew-ps = <0>; /* -420ps */
 			txd1-skew-ps = <0>; /* -420ps */
 			txd2-skew-ps = <0>; /* -420ps */
 			txd3-skew-ps = <0>; /* -420ps */
-			rxd0-skew-ps = <420>; /* 0ps */
-			rxd1-skew-ps = <420>; /* 0ps */
-			rxd2-skew-ps = <420>; /* 0ps */
-			rxd3-skew-ps = <420>; /* 0ps */
 			txen-skew-ps = <0>; /* -420ps */
-			txc-skew-ps = <900>; /* 0ps */
-			rxdv-skew-ps = <420>; /* 0ps */
-			rxc-skew-ps = <1680>; /* 780ps */
+			txc-skew-ps  = <1860>; /* 960ps */
+
+			rxd0-skew-ps = <0>; /* -420ps */
+			rxd1-skew-ps = <0>; /* -420ps */
+			rxd2-skew-ps = <0>; /* -420ps */
+			rxd3-skew-ps = <0>; /* -420ps */
+			rxdv-skew-ps = <0>; /* -420ps */
+			rxc-skew-ps = <1860>; /* 960ps */
+		};
+	};
+};
+
+
+&gmac1 {
+	status = "okay";
+	phy-mode = "rgmii";
+	phy-handle = <&phy1>;
+
+	interrupt-parent = <&portb>;
+	// pin 20 (index starting at 0) of portb (IOB_21)
+	interrupts = <20 IRQ_TYPE_LEVEL_LOW>;
+	altr,sysmgr-syscon = <&sysmgr 0x00000048 0>;
+
+	max-frame-size = <9000>;
+
+	mdio0 {
+		#address-cells = <1>;
+		#size-cells = <0>;
+		compatible = "snps,dwmac-mdio";
+		phy1: ethernet-phy@1 {
+			reg = <4>;
+
+			/*
+			 * All skews are offset since hardware skew values for the ksz9031
+			 * range from a negative skew to a positive skew.
+			 * See the micrel-ksz90x1.txt Documentation file for details.
+			 */
+			txd0-skew-ps = <0>; /* -420ps */
+			txd1-skew-ps = <0>; /* -420ps */
+			txd2-skew-ps = <0>; /* -420ps */
+			txd3-skew-ps = <0>; /* -420ps */
+			txen-skew-ps = <0>; /* -420ps */
+			txc-skew-ps  = <1860>; /* 960ps */
+
+			rxd0-skew-ps = <0>; /* -420ps */
+			rxd1-skew-ps = <0>; /* -420ps */
+			rxd2-skew-ps = <0>; /* -420ps */
+			rxd3-skew-ps = <0>; /* -420ps */
+			rxdv-skew-ps = <0>; /* -420ps */
+			rxc-skew-ps = <1860>; /* 960ps */
 		};
 	};
 };
@@ -103,7 +150,7 @@
 };
 
 &uart0 {
-	status = "okay";
+	status = "disabled";
 };
 
 &uart1 {
@@ -143,7 +190,7 @@
 		status = "okay";
 		compatible = "maxim,max14830";
 		reg = <0x0>;
-		spi-max-frequency = <10000000>;
+		spi-max-frequency = <1000000>;
 		clocks = <&spi_uart_clock>;
 		clock-names = "xtal";
 		interrupt-parent = <&porta>;
@@ -157,7 +204,7 @@
 		status = "okay";
 		compatible = "maxim,max14830";
 		reg = <0x1>;
-		spi-max-frequency = <10000000>;
+		spi-max-frequency = <1000000>;
 		clocks = <&spi_uart_clock>;
 		clock-names = "xtal";
 		interrupt-parent = <&porta>;
@@ -171,7 +218,7 @@
 		status = "okay";
 		compatible = "maxim,max14830";
 		reg = <0x2>;
-		spi-max-frequency = <10000000>;
+		spi-max-frequency = <1000000>;
 		clocks = <&spi_uart_clock>;
 		clock-names = "xtal";
 		interrupt-parent = <&portb>;
@@ -185,7 +232,7 @@
 		status = "okay";
 		compatible = "maxim,max14830";
 		reg = <0x3>;
-		spi-max-frequency = <10000000>;
+		spi-max-frequency = <1000000>;
 		clocks = <&spi_uart_clock>;
 		clock-names = "xtal";
 		interrupt-parent = <&portb>;
-- 
2.19.1

