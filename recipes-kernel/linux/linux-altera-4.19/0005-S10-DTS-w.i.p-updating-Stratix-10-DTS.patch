From 0c5f423858be7b1277f7171bb51cbf9bce0ffa92 Mon Sep 17 00:00:00 2001
From: Amir Ghanbari Bavarsad <amir.b@pervices.com>
Date: Wed, 27 Feb 2019 14:09:04 +0000
Subject: [PATCH 5/9] S10 DTS: w.i.p updating Stratix 10 DTS

These changes are experimental but in the right direction.
---
 .../dts/altera/socfpga_stratix10_socdk.dts    | 109 ++++++++++++++----
 1 file changed, 86 insertions(+), 23 deletions(-)

diff --git a/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts b/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
index 16e44b4c834b..a3848b24ecfc 100644
--- a/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
+++ b/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
@@ -21,7 +21,7 @@
 	model = "SoCFPGA Stratix 10 SoCDK";
 
 	aliases {
-		serial0 = &uart0;
+		serial0 = &uart1;
 		ethernet0 = &gmac0;
 		ethernet1 = &gmac1;
 		ethernet2 = &gmac2;
@@ -53,6 +53,10 @@
 	};
 };
 
+&gpio0 {
+	status = "okay";
+};
+
 &gpio1 {
 	status = "okay";
 };
@@ -61,7 +65,9 @@
 	status = "okay";
 	phy-mode = "rgmii";
 	phy-handle = <&phy0>;
-
+	interrupt-parent = <&portb>;
+	// pin 19 (index starting at 0) of portb (IOB_20)
+	interrupts = <19 IRQ_TYPE_LEVEL_HIGH>;
 	max-frame-size = <9000>;
 
 	mdio0 {
@@ -71,6 +77,8 @@
 		phy0: ethernet-phy@0 {
 			reg = <4>;
 
+			// TODO:
+			// Need to calculate these values
 			txd0-skew-ps = <0>; /* -420ps */
 			txd1-skew-ps = <0>; /* -420ps */
 			txd2-skew-ps = <0>; /* -420ps */
@@ -98,7 +106,11 @@
 	status = "okay";
 };
 
-&usb0 {
+&uart1 {
+	status = "okay";
+};
+
+&usb1 {
 	status = "okay";
 	disable-over-current;
 };
@@ -116,20 +128,70 @@
 
 };
 
-&spi0 {
+&i2c2 {
 	status = "okay";
+	clock-frequency = <100000>;
+	i2c-sda-hold-time-ns = <100>;
+	i2c-sda-falling-time-ns = <300>;  /* hcnt */
+	i2c-sdl-falling-time-ns = <300>;  /* lcnt */
+
+};
 
+&spi0 {
+	status = "okay";
 	max14830@0 {
 		status = "okay";
 		compatible = "maxim,max14830";
 		reg = <0x0>;
-		spi-max-frequency = <1000000>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&porta>;
+		// pin 8 (index starting at 0) of porta
+		// (IOA_9) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <8 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+	max14830@1 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x1>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&porta>;
+		// pin 10 (index starting at 0) of porta
+		// (IOA_11) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <10 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+	max14830@2 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x2>;
+		spi-max-frequency = <10000000>;
 		clocks = <&spi_uart_clock>;
 		clock-names = "xtal";
 		interrupt-parent = <&portb>;
-		// pin 19 (index starting at 0) of portb
-		// (IOB_20) is an Edge-Sensitive Active-Low interrupt
-		interrupts = <19 IRQ_TYPE_EDGE_FALLING>;
+		// pin 15 (index starting at 0) of portb
+		// (IOB_16) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <15 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+	max14830@3 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x3>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&portb>;
+		// pin 17 (index starting at 0) of portb
+		// (IOB_18) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <17 IRQ_TYPE_EDGE_FALLING>;
 		gpio-controller;
 		#gpio-cells = <2>;
 	};
@@ -154,20 +216,21 @@
 		cdns,tchsh-ns = <4>;
 		cdns,tslch-ns = <4>;
 
-		partitions {
-			compatible = "fixed-partitions";
-			#address-cells = <1>;
-			#size-cells = <1>;
-
-			qspi_boot: partition@0 {
-				label = "Boot and fpga data";
-				reg = <0x0 0x4000000>;
-			};
-
-			qspi_rootfs: partition@4000000 {
-				label = "Root Filesystem - JFFS2";
-				reg = <0x4000000 0x4000000>;
-			};
-		};
+		// Currently There are no partitions.
+		// partitions {
+		// 	compatible = "fixed-partitions";
+		// 	#address-cells = <1>;
+		// 	#size-cells = <1>;
+
+		// 	qspi_boot: partition@0 {
+		// 		label = "Boot and fpga data";
+		// 		reg = <0x0 0x4000000>;
+		// 	};
+
+		// 	qspi_rootfs: partition@4000000 {
+		// 		label = "Root Filesystem - JFFS2";
+		// 		reg = <0x4000000 0x4000000>;
+		// 	};
+		// };
 	};
 };
-- 
2.19.1

