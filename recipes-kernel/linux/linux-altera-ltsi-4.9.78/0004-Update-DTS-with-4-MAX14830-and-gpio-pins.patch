From 9d1d84ec12a15d4d339cb60f5c158c18e3d2c47d Mon Sep 17 00:00:00 2001
From: Amir Ghanbari Bavarsad <amir.b@pervices.com>
Date: Thu, 28 Feb 2019 21:32:45 +0000
Subject: [PATCH 4/8] Update DTS with 4 MAX14830, and gpio pins

---
 .../dts/altera/socfpga_stratix10_socdk.dts    | 75 +++++++++++++++++++
 1 file changed, 75 insertions(+)

diff --git a/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts b/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
index 2f37f21a7ac1..7a76d62c5c10 100644
--- a/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
+++ b/arch/arm64/boot/dts/altera/socfpga_stratix10_socdk.dts
@@ -14,6 +14,7 @@
  * this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
+#include "dt-bindings/interrupt-controller/irq.h"
 #include "socfpga_stratix10.dtsi"
 
 / {
@@ -40,6 +41,12 @@
 		regulator-max-microvolt = <330000>;
 	};
 
+	spi_uart_clock: spi_uart_xtal {
+		#clock-cells = <0>;
+		compatible = "fixed-clock";
+		clock-frequency = <3686400>;
+	};
+
 	soc {
 		clkmgr@ffd10000 {
 			clocks {
@@ -113,6 +120,74 @@
 
 };
 
+&gpio0 {
+	status = "okay";
+};
+
+&gpio1 {
+	status = "okay";
+};
+
+&spi0 {
+	status = "okay";
+	max14830@0 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x0>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&porta>;
+		// pin 8 (index starting at 0) of porta
+		// (IOA_9) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <8 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+	max14830@1 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x1>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&porta>;
+		// pin 10 (index starting at 0) of porta
+		// (IOA_11) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <10 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+	max14830@2 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x2>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&portb>;
+		// pin 15 (index starting at 0) of portb
+		// (IOB_16) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <15 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+	max14830@3 {
+		status = "okay";
+		compatible = "maxim,max14830";
+		reg = <0x3>;
+		spi-max-frequency = <10000000>;
+		clocks = <&spi_uart_clock>;
+		clock-names = "xtal";
+		interrupt-parent = <&portb>;
+		// pin 17 (index starting at 0) of portb
+		// (IOB_18) is an Edge-Sensitive Active-Low interrupt
+		interrupts = <17 IRQ_TYPE_EDGE_FALLING>;
+		gpio-controller;
+		#gpio-cells = <2>;
+	};
+};
+
 &qspi {
 	status = "disabled";
 	flash@0 {
-- 
2.20.1

